=pod

=head1 NAME

edg-mkgridmap - a tool to build the grid-mapfile

=head1 SYNOPSIS

B<edg-mkgridmap> [B<--help>] [B<--version>]
              [B<--conf>=I<config_file>]
              [B<--output>[=I<output_file>]]
              [B<--quiet>] [B<--verbose>]
              [B<--safe>] [B<--nosafe>]
              [B<--cache>] [B<--nocache>]
              [B<--proxy>] [B<--noproxy>]
              [B<--usermode>]

=head1 DESCRIPTION

B<edg-mkgridmap> is a tool to build the grid-mapfile from VO servers,
taking into account both VO and local policies.

=head1 CONFIGURATION

F<edg-mkgridmap.conf> file contains configuration information for
B<edg-mkgridmap>.

The syntax of the F<edg-mkgridmap.conf> file is discussed seperately. The
edg-mkgridmap.conf(5) documentation should be consulted for detailed
reference information.

The default location is F</etc/edg-mkgridmap.conf>.

The file essentially consists of a list of directives composed by a
keyword and one or more arguments. Optional arguments are put in square
brackets.

=over 4

=item * B<group> I<URI> I<[lcluser]>

=item * B<default_lcluser> I<default_lcluser>

=item * B<auth> I<URI>

=item * B<allow>|B<deny> I<pattern_to_match>

=item * B<gmf_local> I<grid-mapfile-local>

=back

=head1 OPTIONS

=over 4

=item B<--help>

Print a summary of the command line options end exit.

=item B<--version>

Print the version of B<edg-mkgridmap> end exit.

=item B<--conf>=I<config_file>

Specifies the configuration file that is used by B<edg-mkgridmap>. If
omitted, B<edg-mkgridmap> checks F</var/lib/edg-mkgridmap/etc/edg-mkgridmap.conf> to
see if a machine-specific configuration has been setup. If
such a file is not present, B<edg-mkgridmap>
uses the default configuration file F</etc/edg-mkgridmap.conf>.

=item B<--output>[=I<output_file>]

Specifies the output file. If omitted, I<stdout> is used. If the optional
argument I<output_file> is omitted, the value of the environment variable
B<GRIDMAP> is used. If B<GRIDMAP> is not set, then the default value
F</etc/grid-security/grid-mapfile> is used.

=item B<--quiet>

Turn off error messages.

=item B<--verbose>

Print lots of useful informations. Ignored if B<--quiet> is specified.

=item B<--safe>, B<--nosafe>

Per B<group> keep (B<--safe>) or remove (B<--nosafe>) the old grid-mapfile
entries that are not found back, when at least one of the sources for that
B<group> directive had a problem. Default is remove (B<--nosafe>).

=item B<--cache>, B<--nocache>

Disable (B<--cache>) or enable (B<--nocache>) the grid-mapfile update when
its contents remain unchanged. Default is enable (B<--nocache>).

=item B<--proxy>, B<--noproxy>

Enable (B<--proxy>) or disable (B<--noproxy>) proxy support for HTTP/HTTPS
and VOMS/VOMSS connections. Default is disable (B<--noproxy>).

The proxy support must be configured through appropriate environmental
variables.

=item B<--usermode>

Facilitate running the script as an ordinary user by having the relevant
environment variables point to the user's X509 proxy instead of using the
personal certificate and key.  The user's proxy is taken from the
B<X509_USER_PROXY> environment variable, if defined, else from the
default location F</tmp/x509up_u$UID>.

=back

=head1 ERRORS

In case of one or more errors, B<edg-mkgridmap> returns an exit code which
is computed adding these possible values:

=over 4

=item * B<1>

per B<group> directive for which a server could not be contacted.

=item * B<16>

error reading the configuration file.

=item * B<32>

error writing the grid-mapfile.

=item * B<64>

error with a B<group> directive.

=item * B<128>

error with an B<auth> directive.

=back

=head1 DIAGNOSTICS

The B<--verbose> option produces some useful diagnostics.

Any error message generated by B<edg-mkgridmap> is logged to the
B<syslogd>.

=head1 ENVIRONMENT

=over 4

=item B<EDG_MKGRIDMAP_OPTIONS>

Used to specify command line options.

=item B<GRIDMAP>

Used to determine the location of the grid-mapfile. If not set, then the
default value F</etc/grid-security/grid-mapfile> is used.

=item B<CERTDIR>

Used to determine the directory containing CA certificates. If not set,
then the default value F</etc/grid-security/certificates> is used.

=item B<X509_USER_CERT>

Used to determine the location of the host certificate. If not set, then
the default value F</etc/grid-security/hostcert.pem> is used.

=item B<X509_USER_KEY>

Used to determine the location of the host private key. If not set, then
the default value F</etc/grid-security/hostkey.pem> is used.

=item B<X509_USER_PROXY>

Used to determine the location of the user's proxy when the B<--usermode>
option is given.  If not set, the default value F</tmp/x509up_u$UID> is used.

=item B<http_proxy>

Used to determine the proxy for HTTP connections. The syntax is:

  http_proxy="[http://]<host>:<port>"

=item B<https_proxy>

Used to determine the proxy for HTTPS connections. The syntax is:

  https_proxy="[http://]<host>:<port>"

=back

=head1 EXAMPLES

  edg-mkgridmap

Writes the grid-mapfile to the standard output.

  edg-mkgridmap --output=-

Writes the grid-mapfile to the standard output.

  edg-mkgridmap --output

Writes the grid-mapfile to the default location of the grid-mapfile.

  edg-mkgridmap --output=<output_file>

Writes the grid-mapfile to <output_file>.

=head1 FILES

F</var/lib/edg-mkgridmap/etc/edg-mkgridmap.conf>

F</etc/edg-mkgridmap.conf>

F</usr/libexec/edg-mkgridmap/local-subject2user>

=head1 SEE ALSO

edg-mkgridmap.conf(5)

=head1 AUTHORS

EU DataGrid Authorization Working Group,
EGEE Middleware Security Group, Maarten Litmaath (CERN/WLCG)

=cut
